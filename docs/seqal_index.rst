.. _seqal_index:

Seqal
======


Seqal is a distributed short read mapping and duplicate removal tool.
It implements a distributed version of the BWA_ aligner, and adds a duplicate
read removal feature using the same criteria as the `Picard MarkDuplicates`_ command.

Seqal is part of the :ref:`Seal <index>` suite of sequence alignment applications.

Usage
++++++

Like BWA, Seqal takes as input read pairs to be aligned, and an indexed
reference sequence.  The input read pairs need to be in :ref:`prq format <file_formats_prq>` (PairReadsQSeq
may help you format them quickly), and they need to be located on an HDFS
volume. The indexed reference is a slightly modified version of the one
generated by BWA.  See the following section for instructions.

Preparing the reference index archive
-------------------------------------

Seqal needs a modified version of the BWA index files to run.  To created it
follow these steps:

#. Generate the standard bwa index::

    bwa index [OPTIONS] ref.fa

#. Modify it::

    ./bin/bwa_index_to_mmap ref.fa

   This generates two new files:  ref.fa.sax and ref.fa.rsax.

#. Delete the original ``.sa`` and ``.rsa`` files::

    rm -f ref.fa.*sa

   These two files are not required by Seqal.

#. Build an archive containing the index files at the top level::

    tar cf ref.tar ref.fa.*

Hadoop's distributed cache mechanism will be used to distribute and unpack the
archive on all the cluster nodes.  We recommend not including the original
``.sa`` and ``.rsa`` files since for a full human genome reference they are
large enough to slow the distribution process by a few minutes.  Also, we
recommend not compressing the archive since we have found that decompressing it
adds several minutes to the start-up time, even if copying the file may be
faster.  Using a light compression (e.g. ``gzip --fast``) may be the optimal
solution but we have yet to test it.


Running the application
-----------------------

To run seqal, use the ``bin/seqal`` command.
The command takes the following arguments:

#. Input path (a file or a directory), containing paired sequence data in prq
   format.  If the path references a directory, then all the files inside it
   will be processed.

#. Output directory, where results in SAM format will be written.

#. Reference index archive (see previous section).



Command line options
.......................

In addition the the mandatory arguments, Seqal supports the usual Seal command
line options.  See the :ref:`program_usage` section for details.


Tuning the application
.............................

Seqal provides a number of properties to control its behaviour.
For a full description see the :ref:`seqal_options` page.



.. _BWA:  http://bio-bwa.sourceforge.net/
.. _Picard MarkDuplicates:  http://sourceforge.net/apps/mediawiki/picard/index.php?title=Main_Page#Q:_How_does_MarkDuplicates_work.3F
.. _BWA manpage: http://bio-bwa.sourceforge.net/bwa.shtml
